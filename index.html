<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>PMGâ„¢ EDU | All Courses</title>

<link rel="manifest" href="manifest.json">
<meta name="theme-color" content="#FFD700">

<style>
body {margin:0;font-family:'Playfair Display', serif;background:#0f0f0f;color:#f0f0f0;text-align:center;padding:20px;}
h1{color:#FFD700;font-size:2.5em;}
.section{background:#1b1b1b;padding:20px;border-radius:12px;max-width:900px;margin:20px auto;}
button{padding:12px 20px;border:none;border-radius:10px;font-weight:bold;cursor:pointer}
.paper-btn{background:#2563eb;color:#fff;width:100%;margin:5px 0}
.disabled{opacity:0.4;pointer-events:none}
.hidden{display:none}
</style>
</head>

<body>

<h1>PMGâ„¢ EDU</h1>
<p><b>Demo / Paid Academic Resources</b></p>

<!-- AUTH -->
<div id="auth" class="section">
  <input id="email" placeholder="Email"><br><br>
  <input id="password" type="password" placeholder="Password"><br><br>
  <button onclick="login()">Login</button>
  <button onclick="register()">Register</button>
</div>

<!-- USER -->
<div id="userPanel" class="section hidden">
  <p id="statusText"></p>
  <button onclick="markPaid()">I PAID K20</button>
</div>

<!-- COURSES -->
<div id="content" class="section hidden">
  <h3>Courses</h3>
  <button class="paper-btn" onclick="openPDF()">Open Sample PDF</button>
</div>

<!-- ADMIN -->
<div id="adminPanel" class="section hidden">
  <h2>Admin Dashboard</h2>
  <div id="pendingUsers"></div>
</div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
import { getAuth, createUserWithEmailAndPassword, signInWithEmailAndPassword, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";
import { getFirestore, doc, setDoc, getDoc, updateDoc, collection, getDocs, deleteDoc } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

/* ðŸ”´ REPLACE WITH YOUR FIREBASE CONFIG */
const firebaseConfig = {
  apiKey: "YOUR_API_KEY",
  authDomain: "YOUR_PROJECT.firebaseapp.com",
  projectId: "YOUR_PROJECT_ID",
};

const app = initializeApp(firebaseConfig);
const auth = getAuth(app);
const db = getFirestore(app);

/* AUTH */
window.register = async () => {
  const email = email.value;
  const password = password.value;
  const res = await createUserWithEmailAndPassword(auth, email, password);
  await setDoc(doc(db,"users",res.user.uid),{
    email,
    role:"user",
    paymentStatus:"trial"
  });
};

window.login = async () => {
  await signInWithEmailAndPassword(auth,email.value,password.value);
};

/* AUTH STATE */
onAuthStateChanged(auth, async user=>{
  if(!user) return;
  authDiv(false);

  const ref = doc(db,"users",user.uid);
  const snap = await getDoc(ref);
  const data = snap.data();

  if(data.role==="admin"){
    showAdmin();
  }else{
    showUser(data.paymentStatus);
  }
});

function authDiv(show){
  document.getElementById("auth").classList.toggle("hidden",!show);
}

function showUser(status){
  userPanel.classList.remove("hidden");
  content.classList.remove("hidden");

  if(status==="trial"){
    statusText.innerText="Demo Mode (Locked)";
    content.classList.add("disabled");
  }
  if(status==="pending"){
    statusText.innerText="Payment Pending Approval";
    content.classList.add("disabled");
  }
  if(status==="approved"){
    statusText.innerText="Full Access Granted";
    content.classList.remove("disabled");
  }
}

window.markPaid = async ()=>{
  const u = auth.currentUser;
  await updateDoc(doc(db,"users",u.uid),{paymentStatus:"pending"});
  alert("Payment marked pending");
};

/* ADMIN */
async function showAdmin(){
  adminPanel.classList.remove("hidden");
  const q = await getDocs(collection(db,"users"));
  pendingUsers.innerHTML="";
  q.forEach(d=>{
    const u=d.data();
    if(u.paymentStatus==="pending"){
      pendingUsers.innerHTML+=`
        <p>${u.email}
        <button onclick="approve('${d.id}')">Approve</button>
        <button onclick="removeUser('${d.id}')">Delete</button></p>
      `;
    }
  });
}

window.approve = async(id)=>{
  await updateDoc(doc(db,"users",id),{paymentStatus:"approved"});
  location.reload();
};

window.removeUser = async(id)=>{
  await deleteDoc(doc(db,"users",id));
  location.reload();
};

window.openPDF=()=>{
  alert("PDF opens only when approved");
};
</script>

</body>
</html>
